<!DOCTYPE html>
<html lang="uk">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Автоматизована система управління геоданими - Модуль адресний реєстр</title>
		<link rel="icon" href="img/favicon/favicon.ico" type="image/x-icon">
		<!-- CSS FILES -->
		<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/uikit@latest/dist/css/uikit.min.css">
		<link rel="stylesheet" type="text/css" href="css/dashboard.css">
		<link rel="stylesheet" type="text/css" href="css/perfect-scrollbar.css">
		
        <!--Map CSS------------------>
        <link rel="stylesheet" href="lib/ol/ol.css" type="text/css">
        <link rel="stylesheet" href="lib/ol-layerswitcher/ol-layerswitcher.css" type="text/css">

		<!-- Scrollbar JS FILES -->
		<script src="js/perfect-scrollbar.js"></script>
		
		<!-- UIKIT JS FILES -->
		<script src="https://cdn.jsdelivr.net/npm/uikit@latest/dist/js/uikit.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/uikit@latest/dist/js/uikit-icons.min.js"></script>
        <!--Map JS------------------>
        <!-- <script src="lib/ol/ol.js" defer></script> -->
        <script src="lib/ol/ol.js"></script>
        
        <!-- <script src="https://openlayers.org/en/v5.3.0/build/ol.js"></script> -->
        <script src="lib/ol-layerswitcher/ol-layerswitcher.js"></script>		
		
		 <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
		 <script src="js/Custom.js"></script>
		 
		 <link rel="stylesheet" href="css/select2.min.css" type="text/css">
		<script src="js/select2.min.js"></script>
		<script src="https://unpkg.com/axios/dist/axios.js"></script>
		<link rel="stylesheet" href="css/Custom.css" type="text/css">		
		<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
		<script type="text/javascript">
		$(function () {
		UIkit.offcanvas(document.getElementById("offcanvas-usage")).show();
		UIkit.tooltip(document.getElementById("addAdr")).show();
		location.href="#close";
		MainURL = "http://10.0.16.13:2023/portal/api/v1/register/";
		StreetType =[];
		Street = {
		data: null,
		CARD : {id: 0, aliasOne: "", aliasTwo: "", leftTopLatitude: 0, leftTopLongitude: 0, name: "", rightBottomLatitude: 0, rightBottomLongitude: 0, shortTypeName: "", typeId: 0, typeName: ""},
		CARDempty : {id: 0, aliasOne: "", aliasTwo: "", leftTopLatitude: 0, leftTopLongitude: 0, name: "", rightBottomLatitude: 0, rightBottomLongitude: 0, shortTypeName: "", typeId: 0, typeName: ""},
		URLGET: "/street",
		URLGETS: "/street",
		URLPOST: "/street",
		URLPUT: "/street",
		URLDELETE: "/street"
		};
		Address = {
		data: null,
		
		CARD : {id: 0, addressNumber: "", block: "", cadastre: "", description: "", districtId: 0, latitude: 0, longitude: 0, postCode: 0, status: 0, streetId: 0},
		CARDempty : {id: 0, addressNumber: "", block: "", cadastre: "", description: "", districtId: 0, latitude: 0, longitude: 0, postCode: 0, status: 0, streetId: 0},
		URLGET: "/address",
		URLGETS: "/address",
		URLPOST: "/address",
		URLPUT: "/address",
		URLDELETE: "/address"
		};
		
		getAdditionalyData();
		
		$('#modalCardAddStreet').on({

    'show.uk.modal': function(){
        
    },

    'hide.uk.modal': function(){
	let content;
        content = $('#map').detach();
		content.appendTo('#divmap');
    }
});

		});
		async function getAdditionalyData() {
            try {
				location.href="#load";
				const main = await axios.get(MainURL + getCity());
                if(main.data)
				{
					<!--forEachClassName("custom-logo", i => i.setAttribute("src", main.data.logoUrl));-->
					forEachClassName("citytitle", i => i.textContent= main.data.cityName);
					forEachClassName("maintitle", i => i.textContent= main.data.title);
					forEachClassName("custom-logo", i => i.setAttribute('src', main.data.logoUrl));
				}
				<!--forEachClassName("custom-logo", i => i.setAttribute('src', MainURL + getCity()+"/logo"));-->
                
				const x = await axios.get(MainURL + getCity()+Street.URLGET);
                Street.data = x.data.sort((a, b) => a.name.localeCompare(b.name));
				
				const y = await axios.get(MainURL + getCity()+"/streetype");
                StreetType = y.data;
				fillSelect('typeId', StreetType, "id", "typeName");
				
				paintStreet(Street.data);
            }
            catch {
                UIkit.notification({ message: 'Помилка! Дані не були завантажені', status: 'danger' });
            }
			location.href="#close";

        }
		
		function searchStreet(search){
		if(search != ""){
		let arrayOfStrings = search.split(" ");
		let obj = {...Street.data};
		arrayOfStrings.forEach(function (Item) {
			obj = Object.values(obj).filter(a => (a.name + " " + a.typeName+ " " + a.shortTypeName +" " + a.aliasOne+" " + a.aliasTwo).toUpperCase().indexOf(Item.toUpperCase())>-1);
			});
			paintStreet(obj);
		}
		else
		{
			paintStreet(Street.data);
		}
		}
		function paintStreet(data){
		$("#tbodyStreet").empty();
		data.forEach(function (Item) {
		$('#tbodyStreet').append(`<tr class="uk-visible-toggle"><td onclick='getAddress(${Item.id})'>${Item.name}, ${Item.shortTypeName}</td>
										<td class="uk-text-nowrap"><a onclick='getStreet(${Item.id})' class="uk-icon-button uk-margin-small-right uk-invisible-hover" uk-icon="pencil"></a>
										</td></tr>`);
            });
		}
		async function getAddress(idstreet){
		try {
				const a = await axios.get(MainURL + getCity()+ "/street/" + idstreet + Address.URLGET);
				paintAddress(a.data);
            }
            catch {
                UIkit.notification({ message: 'Помилка! Дані не були завантажені', status: 'danger' });
            }
			location.href="#close";
		
		
		
		}
		function paintAddress(data){
		$("#tbodyAddress").empty();
		data.forEach(function (Item) {
		$('#tbodyAddress').append(`<span class="uk-badge">${Item.addressNumber}</span>`);
            });
		}
		function getStreet(id) {
		location.href="#load";
        emptyformbyclass("Street");
        Street.CARD = Object.assign({}, Street.CARDempty);
        Street.CARD.id = id;
        if (Street.CARD.id != 0) {
			
            $('#h2modalStreet').text('Редагувати вулицю');
			Street.CARD = Street.data.find(a=> a.id == id);
            getobject_ByData(Street.CARD, function before(){}, function after(){let content; content = $('#map').detach();
		content.appendTo('#mapStreet'); showModal('modalCardAddStreet')});
        }
        else {
            $('#h2modalStreet').text('Додати вулицю');
			let content;
            content = $('#map').detach();
		content.appendTo('#mapStreet');
		showModal('modalCardAddStreet');
        }
		
		
		
		location.href="#close";
    }
		
	function deleteStreet(){
	let token = localStorage.getItem('token');
	deleteobject(MainURL + getCity()+Street.URLDELETE + "/" + Street.CARD.id, null, token, function func(){ hideModal('modalCardAddStreet'); getAdditionalyData();});
	}
	
	async function updateStreet(){
	var c = getCardData(Street.CARD, "Street");
        if (c) {
		let id = Street.CARD.id;
		let token = localStorage.getItem('token');
			if(id == 0)
		{
			await saveobject(MainURL + getCity()+Street.URLPOST, c, token, "POST", function before(){
			}, function after() {getAdditionalyData(); hideModal('modalCardAddStreet')});
		}
		else{
		
			await saveobject(MainURL + getCity()+User.URLPUT + "/" + id, c, token, "PUT", function before(){},
			 function after() {getAdditionalyData();hideModal('modalCardAddStreet')});
		}
		
            
        }
	}
		</script>
	</head>
	<body>
<div id="load" class="modalDialog " style="padding-left:calc(50% - 100px); padding-top:200px; overflow-y:auto; z-index:2000;position: fixed">

<div id="modalCardAddStreet"  class="uk-modal-full" uk-modal>
    <div class="uk-modal-dialog uk-height-1-1  uk-modal-body uk-margin-auto-vertical">
	 <button class="uk-modal-close-full uk-close-large" type="button" uk-close></button>
        <form class="uk-form-stacked">
            <legend class="uk-legend uk-heading-bullet uk-padding-small uk-padding-remove-top uk-padding-remove-bottom" id="h2modalStreet"></legend>
            <div class=" uk-grid uk-grid-small uk-grid-match uk-flex-top uk-margin" uk-grid>
			<div class="uk-width-1-2@m uk-grid uk-grid-small uk-grid-match uk-flex-top" uk-grid>
			<div class="uk-width-2-3@s">
                    <label class="uk-form-label required_uk">Адреса</label>
                    <div class="uk-form-controls">
                        <input class="uk-input necessarilytext Street" type="text" id="name">
                    </div>
                </div>
				<div class="uk-width-1-3@s">
                    <label class="uk-form-label required_uk">Тип</label>
                    <div class="uk-form-controls">
					<select class="uk-select necessarilyselect uk-width-1-1 Street"  id="typeId"></select>                       
                    </div>
                </div>
				<div class="uk-width-1-1">
                    <label class="uk-form-label">Аліас 1</label>
                    <div class="uk-form-controls">
                        <textarea class="uk-textarea Street" rows='2'  id="aliasOne"></textarea>
                    </div>
                </div>
				<div class="uk-width-1-1">
                    <label class="uk-form-label">Аліас 2</label>
                    <div class="uk-form-controls">
                        <textarea class="uk-textarea Street" rows='2'  id="aliasTwo"></textarea>
                    </div>
                </div>
				<div class="uk-width-1-1">
				<p class="uk-text-right">
            <button class="uk-button uk-button-default" onclick="deleteStreet()" type="button">Видалити</button>
            <button class="uk-button uk-button-primary" onclick="updateStreet()" type="button">Зберегти</button>
        </p>
		</div>
			</div>
			<div class="uk-width-1-2@m uk-grid uk-grid-small uk-grid-match uk-flex-top" uk-grid>
				<div class="uk-width-1-1" id="mapStreet"></div>
			  
			</div>
                
            </div>
        </form>

        
    </div>
</div>
        <span uk-spinner="ratio: 7"></span>
		</div>
		<!--HEADER-->
		<header id="top-head" class="uk-position-fixed">
			<div class="uk-container uk-container-expand uk-background-default topbar">
				<nav class="uk-navbar uk-dark" data-uk-navbar="mode:click; duration: 250">
					<div class="uk-navbar-left">
						<div class="uk-navbar-item uk-hidden@m">
							<a class="uk-link-reset" href="index.html">
									<img class="custom-logo uk-margin-small-right" src="" alt=""><span class="uk-text-bold maintitle "></span>
							</a>
						</div>
						<ul class="uk-navbar-nav">
							<li><a href="#offcanvas-usage" data-uk-icon="icon:settings" title="Налаштування" uk-toggle></a></li>
						</ul>						
						
					</div>
					<div class="uk-navbar-right">
						<ul class="uk-navbar-nav">
							<li>
								<a href="#" data-uk-icon="icon:user" title="Ваш обліковий запис" data-uk-tooltip></a>
								<div class="uk-navbar-dropdown">
									<ul class="uk-nav uk-navbar-dropdown-nav">
										<li class="uk-nav-header">Обліковий запис</li>
										<li><a href="#"><span data-uk-icon="icon: info"></span> Загальне</a></li>
										<li><a href="#"><span data-uk-icon="icon: refresh"></span> Редагувати</a></li>
										<li><a href="#"><span data-uk-icon="icon: settings"></span> Налаштування</a></li>
										<li class="uk-nav-divider"></li>
										<li><a href="#"><span data-uk-icon="icon: image"></span> Ваші данні</a></li>
										<!--<li class="uk-nav-divider"></li>
										<li><a href="#"><span data-uk-icon="icon: sign-out"></span> Вийти</a></li>-->
									</ul>
								</div>								
							</li>
							<li><a href="login.html" data-uk-icon="icon:  sign-out" title="Вийти" data-uk-tooltip></a></li>
							<li><a class="uk-navbar-toggle" data-uk-toggle data-uk-navbar-toggle-icon href="#offcanvas-nav" title="Додаткове меню" data-uk-tooltip></a></li>
						</ul>
					</div>
				</nav>
			</div>
		</header>
		<!--/HEADER-->
		<!-- LEFT BAR -->
		<aside id="left-col" class="uk-light uk-visible@m">
			<div class="left-logo uk-flex uk-flex-middle content-box-dark">
			<!--<a class="uk-logo" href="#"><img class="custom-logo" src="img/logo.png" alt="">АСУ геоданими</a>-->
			<a class="uk-link-reset" href="index.html">
				<img class="custom-logo uk-margin-small-right" src="" alt=""><span class="uk-text-bold citytitle "></span>
			</a>
			</div>
			
		
			<div class="left-nav-wrap">
				<ul class="uk-nav uk-nav-default uk-nav-parent-icon" data-uk-nav>
					<li class="uk-nav-header uk-heading-bullet">Адресний реєстр</li>
					<li class='uk-active'><a href="index.html"><span data-uk-icon="icon: search" class="uk-margin-small-right"></span>Пошук</a></li>
					<li><a href="#"><span data-uk-icon="icon: history" class="uk-margin-small-right"></span>Аудит</a></li>
					<li><a href="dictionaries.html"><span data-uk-icon="icon: thumbnails" class="uk-margin-small-right"></span>Довідники</a></li>
					<li ><a href="users.html"><span data-uk-icon="icon: users" class="uk-margin-small-right"></span>Користувачі</a></li>
					<li><a href="#"><span data-uk-icon="icon: album" class="uk-margin-small-right"></span>Історія</a></li>
					<li><a href="#"><span data-uk-icon="icon: cloud-upload" class="uk-margin-small-right"></span>Імпорт</a></li>
					<li><a href="#"><span data-uk-icon="icon: cloud-download" class="uk-margin-small-right"></span>Еспорт</a></li>

					<li class="uk-nav-header uk-heading-bullet">Модуль 2</li>
					<li><a href="#"><span data-uk-icon="icon: search" class="uk-margin-small-right"></span>Розділ 1</a></li>
					<li><a href="#"><span data-uk-icon="icon: users" class="uk-margin-small-right"></span>Розділ 2</a></li>
				</ul>
				
				<div class="left-content-box uk-margin-top">
					
						<h5>Статистика</h5>
						<div>
							<span class="uk-text-small">Кількість адрес <small>(+50)</small></span>
							<progress class="uk-progress" value="50" max="100"></progress>
						</div>
						<div>
							<span class="uk-text-small">Додано нових за тиждень <small>(+78)</small></span>
							<progress class="uk-progress success" value="78" max="100"></progress>
						</div>
						<!--<div>
							<span class="uk-text-small">Feedback <small>(-12)</small></span>
							<progress class="uk-progress warning" value="12" max="100"></progress>
						</div>-->
					
				</div>
				
			</div>
			<div class="bar-bottom">
				<ul class="uk-subnav uk-flex uk-flex-center uk-child-width-1-5" data-uk-grid>
					<li>
						<a href="/index" class="uk-icon-link" data-uk-icon="icon: home" title="Головна" data-uk-tooltip></a>
					</li>
					<li>
						<a href="#" class="uk-icon-link" data-uk-icon="icon: settings" title="Налаштування" data-uk-tooltip></a>
					</li>
					<li>
						<a href="#" class="uk-icon-link" data-uk-icon="icon: social"  title="Соціальні мережі, поділитись" data-uk-tooltip></a>
					</li>
					
					<li>
						<a href="login.html" class="uk-icon-link" data-uk-tooltip="Вийти" data-uk-icon="icon: sign-out"></a>
					</li>
				</ul>
			</div>
		</aside>
		<!-- /LEFT BAR -->
		<!-- CONTENT -->
		<div id="content" data-uk-height-viewport="expand: true">
		
		


<div id="offcanvas-usage" class="uk-padding-small" uk-offcanvas="bg-close:false;">

    <div class="aside-second uk-offcanvas-bar-light ">

        <!--<button class="uk-offcanvas-close" type="button" uk-close></button>-->

        <div class="uk-grid-collapse uk-flex uk-flex-middle " uk-grid>
		<div class="uk-width-expand">
		<form class="uk-search uk-search-default uk-width-1-1">
		<span uk-search-icon></span>
		<input class="uk-search-input" type="search" oninput='searchStreet(this.value)' id='search' placeholder="Пошук вулиці">
		</form>
		</div>
		<!--<div >
			<a class="uk-margin-small-left" href="" uk-icon="search"></a>
		</div>-->
		<div>
			<a class="uk-margin-small-left " onclick="$('#search').val('').trigger('oninput')" uk-icon="close"></a>
			<a class="uk-margin-small-left " id='addAdr' onclick="getStreet(0)" uk-tooltip="title: Додати вулицю; delay: 500" uk-icon="plus-circle"></a>
		</div>
        </div>
<div id="container333" class="uk-height-large uk-margin-small aside-second-first" style=" position:relative; top:0; bottom:0;"> 
	
<table class="uk-table uk-table-small ">
    <!--<thead>
        <tr>
            <th>Назва</th>
            <th>Статус</th>
        </tr>
    </thead>-->
    <tbody id='tbodyStreet'>
    </tbody>
</table>
</div>
<hr class="uk-margin-small">
<h4 class="uk-heading-bullet uk-padding-small uk-padding-remove-top uk-padding-remove-bottom">Адреси</h4>
<div id="container444" class="uk-height-small aside-second-second" style=" position:relative; top:0; bottom:0;">
<div id='tbodyAddress'>

</div>
</div>

    </div>
</div>		
		


	
		
		
			<div class="uk-container uk-container-expand">


<div class="" style="margin:-40px;" >







	<div id="divmap"><div id="map" class="map" uk-height-viewport="offset-top: true" ></div></div>

</div>
				

				<script src="js/map/editPanel_Map.js"></script>
				<script src="js/map/Config_Map.js"></script>
				<script src="js/map/Map.js"></script>
				<script src="js/map/Start_Map.js"></script>  

				<script type="text/javascript">
				//проверка тестовых функций карты
				//старт
					function ready() {
					  window.addEventListener("map_editpanel_changed",  function(e){
					  switch(e.detail.layer){
						case 'address':{
						  if (e.detail.action == 'add')
							APP_MAP.createAddress();
						  else if (e.detail.action == 'edit')
							APP_MAP.modifyAddress();
						  else 
							APP_MAP.removeAddress();
						}
						  break;
						case 'street' : {
						  if (e.detail.action == 'add')
							APP_MAP.createStreet();
						  else if (e.detail.action == 'edit')
							APP_MAP.modifyStreet();
						  else 
							APP_MAP.removeStreet();
						  }
							break;
						}
					  }, null);
					  MAP_EDITPANEL.initPanel();   

					function app_alert(e) {
					  //alert('кликнули по координатам ' + e.detail.coordinates)
					}
					window.addEventListener("map_singleclick",  app_alert, null);      
					
					//рисуем
					function app_draw_alert(e) {
					  //alert("нарисовано " + e.detail.coordinates)
					}
					window.addEventListener("map_drawend",  app_draw_alert, null); 

					//редактируем
					function app_modify_alert(e) {
					 // alert("нарисовано " + e.detail.coordinates)
					}
					window.addEventListener("map_modifyend",  app_modify_alert, null);
					MAP_STARTER.start();
					}
					document.addEventListener("DOMContentLoaded", ready);
				//клик по карте
				 
				</script>
			
			
<!--
				<footer class="uk-section uk-section-small uk-text-center">
					<hr>
					<p class="uk-text-small uk-text-center">Всі права захищені 2021</p>
				</footer>
				-->
			</div>
		</div>
		<!-- /CONTENT -->
		<!-- OFFCANVAS -->
		<div id="offcanvas-nav" data-uk-offcanvas="flip: true; overlay: true">
			<div class="uk-offcanvas-bar uk-offcanvas-bar-animation uk-offcanvas-slide">
				<button class="uk-offcanvas-close uk-close uk-icon" type="button" data-uk-close></button>
				<ul class="uk-nav uk-nav-default">
					<li class="uk-active"><a href="#">Active</a></li>
					<li class="uk-parent">
						<a href="#">Parent</a>
						<ul class="uk-nav-sub"> 
							<li><a href="#">Sub item</a></li>
							<li><a href="#">Sub item</a></li>
						</ul>
					</li>
					<li class="uk-nav-header">Header</li>
					<li><a href="#js-options"><span class="uk-margin-small-right uk-icon" data-uk-icon="icon: table"></span> Item</a></li>
					<li><a href="#"><span class="uk-margin-small-right uk-icon" data-uk-icon="icon: thumbnails"></span> Item</a></li>
					<li class="uk-nav-divider"></li>
					<li><a href="#"><span class="uk-margin-small-right uk-icon" data-uk-icon="icon: trash"></span> Item</a></li>
				</ul>
				<h3>Title</h3>
				<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
			</div>
		</div>
		<!-- /OFFCANVAS -->
	    <script>
    new PerfectScrollbar('#container333');
    new PerfectScrollbar('#container444');
    new PerfectScrollbar('#left-col');
    </script>	

	</body>
</html>
