<!DOCTYPE html>
<html lang="uk">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Автоматизована система управління геоданими - Модуль адресний реєстр</title>
		<link rel="icon" href="img/favicon/favicon.ico" type="image/x-icon">
		<!-- CSS FILES -->
		<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/uikit@latest/dist/css/uikit.min.css">
		<link rel="stylesheet" type="text/css" href="css/dashboard.css">
		
        <!--Map CSS------------------>
        <link rel="stylesheet" href="lib/ol/ol.css" type="text/css">
        <link rel="stylesheet" href="lib/ol-layerswitcher/ol-layerswitcher.css" type="text/css">

		<!-- UIKIT JS FILES -->
		<script src="https://cdn.jsdelivr.net/npm/uikit@latest/dist/js/uikit.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/uikit@latest/dist/js/uikit-icons.min.js"></script>
        <!--Map JS------------------>
        <!-- <script src="lib/ol/ol.js" defer></script> -->
        <script src="lib/ol/ol.js"></script>
        
        <!-- <script src="https://openlayers.org/en/v5.3.0/build/ol.js"></script> -->
        <script src="lib/ol-layerswitcher/ol-layerswitcher.js"></script>
		 <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
		
		<script src="js/Custom.js"></script>
		<script src="https://unpkg.com/axios/dist/axios.js"></script>
		<link rel="stylesheet" href="css/Custom.css" type="text/css">		
		<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
		<script type="text/javascript">
		$(function () {
		location.href="#close";
		MainURL = "http://10.0.16.13:2023/portal/api/v1/register/";
		
		TypeStreet = {
		data: null,
		CARD : {id: 0, shortTypeName:"", typeName:""},
		CARDempty : {id: 0, shortTypeName:"", typeName:"" },
		URLGET: "/streetype",
		URLGETS: "/streetype",
		URLPOST: "/streetypeext",
		URLPUT: "/streetypeext",
		URLDELETE: "/streetype"
		};
		District = {
		data: null,
		CARD : {id: 0, name:""},
		CARDempty : {id: 0, name: ""},
		URLGET: "/district",
		URLGETS: "/district",
		URLPOST: "/district",
		URLPUT: "/district",
		URLDELETE: "/district"
		};
		Authority = {
		data: null,
		CARD : {id: 0, Authorityname:"", code: "", comment: ""},
		CARDempty : {id: 0, Authorityname:"", code: "", comment: ""},
		URLGET: "/authority",
		URLGETS: "/authority",
		URLPOST: "/authority",
		URLPUT: "/authority",
		URLDELETE: "/authority"
		};
		
		
		getAdditionalyData();
		});
		async function getAdditionalyData() {
            try {
				location.href="#load";
				
				const main = await axios.get(MainURL + getCity());
                if(main.data)
				{
					<!--forEachClassName("custom-logo", i => i.setAttribute("src", main.data.logoUrl));-->
					forEachClassName("citytitle", i => i.textContent= main.data.cityName);
					forEachClassName("maintitle", i => i.textContent= main.data.title);
				}
				forEachClassName("custom-logo", i => i.setAttribute('src', MainURL + getCity()+"/scan"));
                const x = await axios.get(MainURL + getCity()+TypeStreet.URLGET);
                TypeStreet.data = x.data;
				paintTypesStreet();
				const y = await axios.get(MainURL + getCity()+District.URLGET);
                District.data = y.data;
				paintDistrict();
				const z = await axios.get(MainURL + getCity()+Authority.URLGET);
                Authority.data = z.data;
				paintAuthority();
				
            }
            catch {
                UIkit.notification({ message: 'Помилка! Дані не були завантажені', status: 'danger' });
            }
			location.href="#close";

        }
		
		function paintAuthority(){
		$("#tbodyAuthority").empty();
		Authority.data.forEach(function (Item) {
		$('#tbodyAuthority').append(`<tr><td>${Item.name}</td><td>${Item.code}</td><td>${Item.comment? Item.comment : ""}</td>
										<td class="uk-text-nowrap"><a onclick='getAuthority(${Item.id})' class="uk-icon-button uk-margin-small-right" uk-icon="pencil"></a>
											<a class="uk-icon-button uk-margin-small-right" onclick='deleteAuthority(${Item.id})' uk-icon="trash"></a>
										</td></tr>`);
            });
		}
		function paintDistrict(){
		$("#tbodyDistrict").empty();
		District.data.forEach(function (Item) {
		$('#tbodyDistrict').append(`<tr><td>${Item.name}</td>
										<td class="uk-text-nowrap"><a onclick='getDistrict(${Item.id})' class="uk-icon-button uk-margin-small-right" uk-icon="pencil"></a>
											<a class="uk-icon-button uk-margin-small-right" onclick='deleteDistrict(${Item.id})' uk-icon="trash"></a>
										</td></tr>`);
            });
		}
        function paintTypesStreet(){
		$("#tbodyTypeStreet").empty();
		TypeStreet.data.forEach(function (Item) {
		$('#tbodyTypeStreet').append(`<tr><td>${Item.typeName} (${Item.shortTypeName})</td>
										<td class="uk-text-nowrap"><a onclick='getTypeStreet(${Item.id})' class="uk-icon-button uk-margin-small-right" uk-icon="pencil"></a>
											<a class="uk-icon-button uk-margin-small-right" onclick='deleteTypeStreet(${Item.id})' uk-icon="trash"></a>
										</td></tr>`);
            });
		}
		
		function getAuthority(id) {
		location.href="#load";
        emptyformbyclass("Authority");
        Authority.CARD = Object.assign({}, Authority.CARDempty);
        Authority.CARD.id = id;
        if (Authority.CARD.id != 0) {
            $('#h2modalCardAddAuthority').text('Редагувати');
			Authority.CARD = Authority.data.find(a=> a.id == id);
			Authority.CARD.Authorityname = Authority.CARD.name;
            getobject_ByData(Authority.CARD, function before(){}, function after(){showModal('modalCardAddAuthority')});
        }
        else {
            $('#h2modalCardAddAuthority').text('Додати');
            showModal('modalCardAddAuthority');
        }
		location.href="#close";
    }
		function getDistrict(id) {
		location.href="#load";
        emptyformbyclass("District");
        District.CARD = Object.assign({}, District.CARDempty);
        District.CARD.id = id;
        if (District.CARD.id != 0) {
            $('#h2modalCardAddDistrict').text('Редагувати');
			District.CARD = District.data.find(a=> a.id == id);
            getobject_ByData(District.CARD, function before(){}, function after(){showModal('modalCardAddDistrict')});
        }
        else {
            $('#h2modalCardAddDistrict').text('Додати');
            showModal('modalCardAddDistrict');
        }
		location.href="#close";
    }
		function getTypeStreet(id) {
		location.href="#load";
        emptyformbyclass("TypeStreet");
        TypeStreet.CARD = Object.assign({}, TypeStreet.CARDempty);
        TypeStreet.CARD.id = id;
        if (TypeStreet.CARD.id != 0) {
            $('#h2modalCardAddTypeStreet').text('Редагувати');
			TypeStreet.CARD = TypeStreet.data.find(a=> a.id == id);
            getobject_ByData(TypeStreet.CARD, function before(){}, function after(){showModal('modalCardAddTypeStreet')});
        }
        else {
            $('#h2modalCardAddTypeStreet').text('Додати');
            showModal('modalCardAddTypeStreet');
        }
		location.href="#close";
    }
	
	function deleteAuthority(id){
	let token = localStorage.getItem('token');
	deleteobject(MainURL + getCity()+Authority.URLDELETE + "/" + id, null, token, function func(){ getAdditionalyData();});
	}
	function deleteDistrict(id){
	let token = localStorage.getItem('token');
	deleteobject(MainURL + getCity()+District.URLDELETE + "/" + id, null, token, function func(){ getAdditionalyData();});
	}
	function deleteTypeStreet(id){
	let token = localStorage.getItem('token');
	deleteobject(MainURL + getCity()+TypeStreet.URLDELETE + "/" + id, null, token, function func(){ getAdditionalyData();});
	}
	
	async function updateAuthority(){
	var c = getCardData(Authority.CARD, "Authority");
        if (c) {
		c.name = c.Authorityname;
		let id = Authority.CARD.id;
		let token = localStorage.getItem('token');
			if(id == 0)
		{
			await saveobject(MainURL + getCity()+Authority.URLPOST, c, token, "POST", function before(){
			}, function after() {getAdditionalyData(); hideModal('modalCardAddAuthority')});
		}
		else{
		
			await saveobject(MainURL + getCity()+Authority.URLPUT + "/" + id, c, token, "PUT", function before(){},
			 function after() {getAdditionalyData();hideModal('modalCardAddAuthority')});
		}
		
            
        }
	}
	async function updateDistrict(){
	var c = getCardData(District.CARD, "District");
        if (c) {
		let id = District.CARD.id;
		let token = localStorage.getItem('token');
			if(id == 0)
		{
			await saveobject(MainURL + getCity()+District.URLPOST, c, token, "POST", function before(){
			}, function after() {getAdditionalyData(); hideModal('modalCardAddDistrict')});
		}
		else{
		
			await saveobject(MainURL + getCity()+District.URLPUT + "/" + id, c, token, "PUT", function before(){},
			 function after() {getAdditionalyData();hideModal('modalCardAddDistrict')});
		}
		
            
        }
	}
	async function updateTypeStreet(){
	var c = getCardData(TypeStreet.CARD, "TypeStreet");
        if (c) {
		let id = TypeStreet.CARD.id;
		let token = localStorage.getItem('token');
			if(id == 0)
		{
			await saveobject(MainURL + getCity()+TypeStreet.URLPOST, c, token, "POST", function before(){
			}, function after() {getAdditionalyData(); hideModal('modalCardAddTypeStreet')});
		}
		else{
		
			await saveobject(MainURL + getCity()+TypeStreet.URLPUT + "/" + id, c, token, "PUT", function before(){},
			 function after() {getAdditionalyData();hideModal('modalCardAddTypeStreet')});
		}
		
            
        }
	}
		
		</script>
	</head>
	<body>
<div id="load" class="modalDialog" style="padding-left:calc(50% - 100px); padding-top:200px; overflow-y:auto; z-index:2000;position: fixed">

        <span uk-spinner="ratio: 7"></span>
		</div>
		<!--HEADER-->
		<header id="top-head" class="uk-position-fixed">
			<div class="left-logo uk-flex uk-flex-middle content-box-dark">
			<a class="uk-link-reset" href="index.html">
				<img class="custom-logo uk-margin-small-right" src="" alt=""><span class="uk-text-bold maintitle "></span>
			</a>
			</div>
		</header>
		<!--/HEADER-->
		<!-- LEFT BAR -->
		<aside id="left-col" class="uk-light uk-visible@m">
			<div class="left-logo uk-flex uk-flex-middle content-box-dark">
			<a class="uk-link-reset" href="index.html">
				<img class="custom-logo uk-margin-small-right" src="" alt=""><span class="uk-text-bold citytitle "></span>
			</a>
			</div>
			<div class="left-nav-wrap">
				<ul class="uk-nav uk-nav-default uk-nav-parent-icon" data-uk-nav>
					<li class="uk-nav-header uk-heading-bullet">Адресний реєстр</li>
					<li><a href="index.html"><span data-uk-icon="icon: search" class="uk-margin-small-right"></span>Пошук</a></li>
					<li><a href="#"><span data-uk-icon="icon: history" class="uk-margin-small-right"></span>Аудит</a></li>
					<li class='uk-active'><a href="dictionaries.html"><span data-uk-icon="icon: thumbnails" class="uk-margin-small-right"></span>Довідники</a></li>
					<li><a href="users.html"><span data-uk-icon="icon: users" class="uk-margin-small-right"></span>Користувачі</a></li>
					<li><a href="#"><span data-uk-icon="icon: album" class="uk-margin-small-right"></span>Історія</a></li>
					<li><a href="#"><span data-uk-icon="icon: cloud-upload" class="uk-margin-small-right"></span>Імпорт</a></li>
					<li><a href="#"><span data-uk-icon="icon: cloud-download" class="uk-margin-small-right"></span>Еспорт</a></li>

					<li class="uk-nav-header uk-heading-bullet">Модуль 2</li>
					<li><a href="#"><span data-uk-icon="icon: search" class="uk-margin-small-right"></span>Розділ 1</a></li>
					<li><a href="#"><span data-uk-icon="icon: users" class="uk-margin-small-right"></span>Розділ 2</a></li>
				</ul>
				
				<div class="left-content-box uk-margin-top">
					
						<h5>Статистика</h5>
						<div>
							<span class="uk-text-small">Кількість адрес <small>(+50)</small></span>
							<progress class="uk-progress" value="50" max="100"></progress>
						</div>
						<div>
							<span class="uk-text-small">Додано нових за тиждень <small>(+78)</small></span>
							<progress class="uk-progress success" value="78" max="100"></progress>
						</div>
						<!--<div>
							<span class="uk-text-small">Feedback <small>(-12)</small></span>
							<progress class="uk-progress warning" value="12" max="100"></progress>
						</div>-->
					
				</div>
				
			</div>
			<div class="bar-bottom">
				<ul class="uk-subnav uk-flex uk-flex-center uk-child-width-1-5" data-uk-grid>
					<li>
						<a href="index.html" class="uk-icon-link" data-uk-icon="icon: home" title="Головна" data-uk-tooltip></a>
					</li>
					<li>
						<a href="#" class="uk-icon-link" data-uk-icon="icon: settings" title="Налаштування" data-uk-tooltip></a>
					</li>
					<li>
						<a href="#" class="uk-icon-link" data-uk-icon="icon: social"  title="Соціальні мережі, поділитись" data-uk-tooltip></a>
					</li>
					
					<li>
						<a href="login.html" class="uk-icon-link" data-uk-tooltip="Вийти" data-uk-icon="icon: sign-out"></a>
					</li>
				</ul>
			</div>
		</aside>
		<div id="content" data-uk-height-viewport="expand: true">
    <div id="modalCardAddAuthority" bg-close="false" class="uk-modal-container uk-flex-top" uk-modal>
    <div class="uk-modal-dialog m uk-modal-body uk-margin-auto-vertical">
        <form class="uk-form-stacked">
            <legend class="uk-legend" id="h2modalCardAddAuthority"></legend>
            <div class="uk-grid uk-grid-small uk-grid-match uk-flex-top" uk-grid>

                <div class="uk-width-1-2@s">
                    <label class="uk-form-label required_uk">Назва</label>
                    <div class="uk-form-controls">
                        <input class="uk-input necessarilytext Authority" type="text" id="Authorityname">
                    </div>
                </div>
				<div class="uk-width-1-2@s">
                    <label class="uk-form-label required_uk">Код ЄДРПОУ</label>
                    <div class="uk-form-controls">
                        <input class="uk-input necessarilytext Authority" type="text" id="code">
                    </div>
                </div>
				<div class="uk-width-1-1">
                    <label class="uk-form-label">Додаткова інформація</label>
                    <div class="uk-form-controls">
                        <textarea class="uk-textarea Authority" rows='3'  id="comment"></textarea>
                    </div>
                </div>
            </div>
        </form>

        <p class="uk-text-right">
            <button class="uk-button uk-button-default uk-modal-close" type="button">Відмінити</button>
            <button class="uk-button uk-button-primary" onclick="updateAuthority()" type="button">Зберегти</button>
        </p>
    </div>
</div>
			<div id="modalCardAddDistrict" bg-close="false" class="uk-modal-container uk-flex-top" uk-modal>
    <div class="uk-modal-dialog m uk-modal-body uk-margin-auto-vertical">
        <form class="uk-form-stacked">
            <legend class="uk-legend" id="h2modalCardAddDistrict"></legend>
            <div class="uk-grid uk-grid-small uk-grid-match uk-flex-top" uk-grid>

                <div class="uk-width-1-1">
                    <label class="uk-form-label required_uk">Повна назва</label>
                    <div class="uk-form-controls">
                        <input class="uk-input necessarilytext District" type="text" id="name">
                    </div>
                </div>
            </div>
        </form>

        <p class="uk-text-right">
            <button class="uk-button uk-button-default uk-modal-close" type="button">Відмінити</button>
            <button class="uk-button uk-button-primary" onclick="updateDistrict()" type="button">Зберегти</button>
        </p>
    </div>
</div>
		<div id="modalCardAddTypeStreet" bg-close="false" class="uk-modal-container uk-flex-top" uk-modal>
    <div class="uk-modal-dialog m uk-modal-body uk-margin-auto-vertical">
        <form class="uk-form-stacked">
            <legend class="uk-legend" id="h2modalCardAddTypeStreet"></legend>
            <div class="uk-grid uk-grid-small uk-grid-match uk-flex-top" uk-grid>

                <div class="uk-width-1-1">
                    <label class="uk-form-label required_uk">Повна назва</label>
                    <div class="uk-form-controls">
                        <input class="uk-input necessarilytext TypeStreet" type="text" id="typeName">
                    </div>
                </div>
                <div class="uk-width-1-1">
                    <label class="uk-form-label required_uk">Скорочена назва</label>
                    <div class="uk-form-controls">
                        <input class="uk-input necessarilytext TypeStreet" type="text" id="shortTypeName">
                    </div>
                </div>
            </div>
        </form>

        <p class="uk-text-right">
            <button class="uk-button uk-button-default uk-modal-close" type="button">Відмінити</button>
            <button class="uk-button uk-button-primary" onclick="updateTypeStreet()" type="button">Зберегти</button>
        </p>
    </div>
</div>
			<div class="uk-container uk-container-expand">
								<ul uk-tab>
									<li><a href="#">Типи вулиць</a></li>
									<li><a href="#">Райони</a></li>
									<li><a href="#">Органи</a></li>
									
								</ul>

								<ul class="uk-switcher uk-margin">
									<li>
									<div class="uk-card-body uk-card uk-card-default uk-card-small">
										<p uk-margin>
											<a class="uk-button uk-button-default" uk-tooltip="Додати новий тип вулиці" onclick='getTypeStreet(0)'>Додати</a>
										</p>									
										<table class="uk-table uk-table-middle uk-table-divider uk-table-small" >
											<thead>
												<tr>
													<th class="uk-width-expand"></th>
													<th></th>
												</tr>
											</thead>
											<tbody id="tbodyTypeStreet">
																							
											</tbody>
										</table>	
									</div>										
									</li>
									
									<li>
									<div class="uk-card-body uk-card uk-card-default uk-card-small">
										<p uk-margin>
											<a class="uk-button uk-button-default" uk-tooltip="Додати новий район" onclick='getDistrict(0)'>Додати</a>
										</p>									
										<table class="uk-table uk-table-middle uk-table-divider uk-table-small" >
											<thead>
												<tr>
													<th class="uk-width-expand"></th>
													<th></th>
												</tr>
											</thead>
											<tbody id="tbodyDistrict">
																							
											</tbody>
										</table>	
									</div>			
									</li>
									<li>
									<div class="uk-card-body uk-card uk-card-default uk-card-small">
										<p uk-margin>
											<a class="uk-button uk-button-default" uk-tooltip="Додати новий орган" onclick='getAuthority(0)'>Додати</a>
										</p>									
										<table class="uk-table uk-table-middle uk-table-divider uk-table-small" >
											<thead>
												<tr>
												<th class="uk-width-auto">Назва</th>
												<th class="uk-width-auto">Код ЄДРПОУ</th>
													<th class="uk-width-expand">Додатково</th>
													<th class="uk-width-auto"></th>
												</tr>
											</thead>
											<tbody id="tbodyAuthority">
																							
											</tbody>
										</table>	
									</div>	
									</li>
								</ul>		
			



				<footer class="uk-section uk-section-small uk-text-center">
					<hr>
					<p class="uk-text-small uk-text-center">Всі права захищені 2021</p>
					<!--
					- <a href="#">MC</a> | Створено за допомоги <a href="http://getuikit.com" title="Відвідати UIkit 3" target="_blank" data-uk-tooltip><span data-uk-icon="uikit"></span></a> </p>
					-->
				</footer>
			</div>
		</div>
	</body>
</html>
